<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Football Thingy</title>

</head>

<body onload="BootFunction()">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sarpanch">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css>Gantari">
    <link rel="stylesheet" href="./assets/styles.css">

    <img class="HeadImage" src="./assets/images/HeadImage.png" alt="Header" onclick="">

    <br />
    <button class="logoutButton" id="logoutButton" style="display: none">Logout</button>
    <nav class="topnav">
        <div>
            <a href="./index.html">Home</a>
            <a class="active" href="./survey.html">Survey</a>
            <a href="TEMP">TEMP</a>
            <a href="TEMP">TEMP</a>
            <a href="TEMP">TEMP</a>
            <a href="TEMP">TEMP</a>
            <a href="TEMP">TEMP</a>
            <a href="TEMP">TEMP</a>
            <a href="TEMP">TEMP</a>
        </div>
        <h3 id="userID"></h3>
    </nav>

    <br />
    <form id="login-form">
        <div>
            <label for="username">UserID:</label>
            <input id="username" name="username" required>
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <button class="LoginButton" type="submit">Login</button>
    </form>
    <div id="message"></div>

    <header>
        <select type=text list=value>
            <option>content</option>
            <option>content</option>
            <option>content</option>
            <option>content</option>
            <option>content</option>
        </select>

        <label>This Type of Chart</label>
    </header>

    <div>
        <canvas id="pChart" width="800" height="400"></canvas>

        <script>

            document.addEventListener('DOMContentLoaded', async function () {

                const _Response = await axios.get('http://football.cscprof.com/coaches');

                const coachesData = _Response.data;

                for (var i = 0; i < coachesData.length; i++) {
                    if (coachesData[i].userID == localStorage.getItem('loggedInUser')) {
                        _CurrentCoachData = coachesData[i];
                    }
                }

                var _SurveyData = [];

                console.log(_CurrentCoachData.coachID);

                var _String = 'http://football.cscprof.com/coaches/' + _CurrentCoachData.coachID + '/answers';

                console.log(_String);

                const _Response2 = await axios.get(_String)

                _SurveyData = _Response2.data;

                const _Answers = _SurveyData.answers;

                console.log(_Answers);

                var _ChartData = [];

                for (var i = 1; i < 5; i++) {

                    var _AverageScore = [];

                    for (var j = 0; j < 18; j++) {

                        if (parseInt(_Answers[j].Answer) == i) {
                            _AverageScore.push(parseInt(_Answers[j].Answer));
                        }

                    }

                    console.log(_AverageScore);

                    _ChartData[i] = calculateAverage(_AverageScore);



                }

                const chartData = {
                    labels: ["Red", "2 points", "3 points", "4 points"],
                    datasets: [{
                        label: 'Distribution of scores',
                        data: _ChartData,
                        backgroundColor: 'rgb(255, 215, 0)',
                        borderColor: 'rgb(0, 0, 0)',
                        borderWidth: 1
                    }]
                };

                const ctx = document.getElementById('pChart').getContext('2d');
                const scatterChart = new Chart(ctx, {
                    type: 'pie',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                title: {
                                    display: true,
                                    text: 'SurveyID',
                                    fontSize: 14,
                                }
                            },
                            y: {
                                type: 'linear',
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Score',
                                    fontSize: 14,
                                }
                            }
                        }
                    }
                });
            })

            function calculateAverage(array) {
                var sum = 0;
                for (var i = 0; i < array.length; i++) {
                    sum += array[i];
                }
                return sum / array.length;
            } 
        

        </script>
    </div>

    <footer>
        <h2>Extra information</h2>
        <p>
            <button>Email</button>
            <button>Help</button>
            <button>Chat</button>
        </p>
        <p>
            Conditions Of Use
        </p>
        <p>
            Privacy Notice
        </p>
        <p>
            Your Ads
        </p>      <p>
            1996-2023, Devious Publishing, Inc
        </p>
    </footer>




    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const storedUsername = localStorage.getItem('loggedInUser');
            const logoutButton = document.getElementById('logoutButton');
            const userIDElement = document.getElementById('userID');
            const loginForm = document.getElementById('login-form');

            if (storedUsername) {
                userIDElement.textContent = 'User ID: ' + storedUsername;

                if (loginForm) {
                    loginForm.remove();
                }

                logoutButton.style.display = 'block';

                logoutButton.addEventListener('click', function () {
                    localStorage.removeItem('loggedInUser');
                    location.reload();
                    //removes stored user data
                });
            } else {
                if (logoutButton) {
                    logoutButton.style.display = 'none';
                }
            }
        });

        const loginForm = document.getElementById('login-form');
        const messageDiv = document.getElementById('message');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await axios.get('http://football.cscprof.com/coaches');

                const coachesData = response.data;
                const foundCoach = coachesData.find(coach => coach.userID === username && coach.Password === password);

                if (foundCoach) {
                    messageDiv.textContent = 'Logged In.';

                    localStorage.setItem('loggedInUser', username);

                    const userIDElement = document.getElementById('userID');
                    userIDElement.textContent = username;

                    if (loginForm) {
                        loginForm.remove();
                    }

                    const logoutButton = document.getElementById('logoutButton');
                    if (logoutButton) {
                        logoutButton.style.display = 'block';
                    }
                } else {
                    messageDiv.textContent = 'Wrong username or password.';
                }
            } catch (error) {
                console.error(error);
                messageDiv.textContent = 'Error connecting to the database';
            }
        });

        async function BootFunction() {



            if (localStorage.getItem('loggedInUser') == null) {
                window.location.href = 'survey.html';
            }


        }




    </script>
</body>
</html>